# SeniorDesign-team8
Our group repo for our Senior Design project.

## Help Request System Update

We've added several new features to the help request system:

1. **Worldwide Address Support**: The address validation has been relaxed to support international addresses.
2. **Custom Emergency Type Input**: When selecting "Other" as the emergency type, users can now specify their emergency.
3. **Fact-Checking & Confidence Score**: The system now verifies help requests against BlueSky tweet data and assigns a confidence score (Low, Medium, High) that is displayed to first responders.
4. **Smart Location Matching**: The system can match state abbreviations with full names (e.g., "KY" ↔ "Kentucky") and country codes with full names (e.g., "US" ↔ "United States" ↔ "USA").
5. **US State Priority Matching**: For addresses containing USA references, the system prioritizes matching state information, which improves accuracy for US-based emergency requests.

### Setup Instructions

To set up the help_requests table in your Supabase database, run the following SQL in the SQL Editor:

```sql
-- Create help_requests table
CREATE TABLE public.help_requests (
    id bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    name text,
    location text,
    contact_info text,
    emergency_type text,
    other_emergency_details text,
    description text,
    status text DEFAULT 'pending'::text,
    confidence_score text
);

-- Enable Row Level Security
ALTER TABLE public.help_requests ENABLE ROW LEVEL SECURITY;

-- Allow anonymous users to insert help requests
CREATE POLICY "Allow anonymous users to insert help requests" ON public.help_requests
    FOR INSERT TO anon WITH CHECK (true);

-- Allow anonymous users to read help requests
CREATE POLICY "Allow anonymous users to read help requests" ON public.help_requests
    FOR SELECT TO anon USING (true);

-- Allow anonymous users to update help requests
CREATE POLICY "Allow anonymous users to update help requests" ON public.help_requests
    FOR UPDATE TO anon USING (true) WITH CHECK (true);

-- Ensure anonymous users can access gen_ai_output
ALTER TABLE IF EXISTS public.gen_ai_output ENABLE ROW LEVEL SECURITY;
CREATE POLICY IF NOT EXISTS "Allow anonymous users to read gen_ai_output" ON public.gen_ai_output
    FOR SELECT TO anon USING (true);
```

### How Confidence Score Works

The confidence score is calculated by:
1. Extracting keywords from the user's location and disaster type
2. Expanding location keywords to include state/country code variations (e.g., "KY" is expanded to include "Kentucky")
3. For US addresses (containing "USA", "US", etc.), prioritizing state information in matching
4. Querying the `gen_ai_output` table for genuine disaster tweets that match the location and/or disaster type
5. Assigning confidence levels based on the following criteria:
   - **High**: Tweets match both the state (for US addresses) AND disaster type, OR at least 1 tweet matches both the location AND disaster type
   - **Medium**: Some tweets match EITHER the location OR disaster type, but none match both
   - **Low**: No matching tweets found for either criterion

### Supported Location Abbreviations

The system recognizes:
- All standard two-letter US state codes (AL, AK, AZ, etc.) and their full names
- 70+ country codes with their variations, including:
  - "US" matches "United States", "USA", "America"
  - "UK" matches "United Kingdom", "Great Britain", "England" 
  - "DE" matches "Germany", "Deutschland"
  - "ES" matches "Spain", "España" 
  - And many more covering countries across all continents

### Smart US Address Processing

For addresses that include US references (like "USA", "United States", "America", etc.), the system:
1. Identifies the state portion of the address (either abbreviation or full name)
2. Gives priority to tweets that mention that specific state
3. Assigns a high confidence score if the state and disaster match, regardless of other location elements

This approach ensures more relevant results for US-based emergencies by focusing on the state-level information, which is most relevant for disaster response in the United States.

This extensive location matching helps ensure that help requests can be accurately verified regardless of how the location is entered or referenced in tweets.
